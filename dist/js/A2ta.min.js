"use strict";var A2ta=A2ta||{};function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(A2ta=function(){var e={loadingPage:{containerID:"loadingPage"},sitePage:{sections:"[data-section]"},header:{menuTriggerID:"hamburger"},map:{containerID:"a2taMap",defaultLat:"",defaultLng:"",defaultZoom:""},search:{searchID:"mapSearch",triggerID:"openAdvancedSearch",fulltextPanelID:"fulltextSearch",advancedPanelID:"advancedSearch",labelClass:"mp-Form_Label",messageID:"searchFormMessage",messageClass:"mp-Form_Message mp-Form_Message-Info",messageLabelClass:"mp-Form_MessageLabel",messageDeleteClass:"btn mp-Form_DeleteMessage",scrollContainerClass:"mp-Scroll",scrollbarClass:"mp-Scroll_Scrollbar",scrollbarFillClass:"mp-Scroll_ScrollbarFill",categoryClass:"mp-Category"},keywords:{containerID:"mapSearchKeywords",listClass:"mp-Keywords_List",listItemClass:"mp-Keywords_ListItem",labelClass:"mp-Keywords_Label",buttonClass:"btn mp-Keywords_DeleteKeyword",buttonID:"deleteKeyword"}},t=null,a=null;function n(){var t=document.querySelectorAll(e.sitePage.sections);setTimeout((function(){a.children[0].classList.add("is-visible"),t.forEach((function(e){e.classList.add("is-visible")})),a.children[0].style.transform=""}),900)}function r(e){t.classList.remove("is-js-ready","is-visible"),t.classList.add("is-hidden"),document.body.classList.remove("is-locked"),t.removeEventListener("swiped-up",r,!1),t.removeEventListener("click",r,!1),n()}return{config:e,init:function(){t=document.getElementById(e.loadingPage.containerID);var i=document.querySelector("footer"+e.sitePage.sections);document.body.style.paddingBottom=i.offsetHeight+"px",a=document.querySelector("main"+e.sitePage.sections);var o=window.innerHeight/4;a.children[0].style.transform="translate3d(0, "+o+"px, 0)",t&&t.classList.contains("is-visible")?(document.body.classList.add("is-locked"),t.classList.add("is-js-ready"),t.addEventListener("swiped-up",r,!1),t.addEventListener("click",r,!1)):n(),A2ta.siteHeader.init()}}}()).siteHeader=A2ta.siteHeader||{},A2ta.siteHeader=function(){var e=null,t=0,a=0;function n(){var n=window.scrollY;Math.abs(t-n)<=5||(n>t&&n>a?(e.classList.remove("is-visible"),e.classList.add("is-hidden")):n+window.innerHeight<document.documentElement.offsetHeight&&(e.classList.remove("is-hidden"),e.classList.add("is-visible")),t=n)}function r(e){this.classList.contains("is-active")?this.classList.remove("is-active"):this.classList.add("is-active")}return{init:function(){var t;e=document.body.querySelector("header"+A2ta.config.sitePage.sections),a=e.offsetHeight,window.onscroll=function(e){cancelAnimationFrame(t),t=requestAnimationFrame(n)},e.querySelector("#"+A2ta.config.header.menuTriggerID).addEventListener("click",r,!1)}}}(),A2ta.Map=A2ta.Map||{},A2ta.Map=function(){var e=null,t=null;function a(t,a){var n=[];if(e.markerCluster=L.markerClusterGroup(e.options.clusterOptions).addTo(e),$.each(t.features,(function(t,a){if("Point"===a.geometry.type&&a.geometry.coordinates[0]){var r=L.marker([a.geometry.coordinates[1],a.geometry.coordinates[0]]);e.setGeoJsonFeatureIcon(a,r),e.setGeoJsonFeaturePopup(a,r),r.feature=a,n.push(r)}})),e.markerCluster.addLayers(n),a)e.setView([A2ta.config.map.defaultLat,A2ta.config.map.defaultLng],A2ta.config.map.defaultZoom);else{var r=e.markerCluster.getBounds();e.fitBounds(r,{maxZoom:16})}}return{init:function(a){(function(e){e.options.zoomControl=!1,L.control.zoom({position:"bottomleft"}).addTo(e)})(e=a),A2ta.config.map.defaultLat=e.options.center[0],A2ta.config.map.defaultLng=e.options.center[1],A2ta.config.map.defaultZoom=e.options.zoom,t=document.getElementById(A2ta.config.map.containerID),A2ta.Map.Search.init()},chargerGeoPoints:function(t){if(Array.isArray(t))if(t.length){var n={id_association:[],id_mot:[],ville:[],limit:500};e.removeAllMarkers();for(var r=0;r<t.length;r++){var i,o=t[r].split(":");for(i in n){var s=o[0],l=n[s].length;i===s&&(n[s][l]=o[1])}}var c=$.param(n),u="http.api/collectionjson/associations?";$.getJSON(u+c).done((function(e){var t={id_association:[]};$.each(e.collection.items,(function(e,a){t.id_association[e]=a.data[0].value}));var n="?page=gis_json&objets=associations_env&limit=500&"+$.param(t);$.getJSON(n).done((function(e){a(e,!1)}))})).fail((function(e,t,a){var n=A2ta.Map.Search.getNoResultMessage();document.querySelector("#"+A2ta.config.keywords.containerID).appendChild(n)}))}else{u="?page=gis_json&objets=associations&limit=500";$.getJSON(u).done((function(e){a(e,!0)}))}},getMapContainer:function(){return t}}}(),A2ta.Map.Search=A2ta.Map.Search||{},A2ta.Map.Search=function(){var e=null,t=[],a=[];function n(e){r({label:this.dataset.label,value:this.dataset.value})}function r(e){var n=e.label,r=e.value;if(-1==a.indexOf(r)){t.push(n),a.push(r);t.length;!function(e,t){var n=document.querySelector("#"+A2ta.config.keywords.containerID),r=n.firstChild;r||((r=document.createElement("ul")).className=A2ta.config.keywords.listClass);r.appendChild(e),n.appendChild(r);var i=A2ta.config.search.messageClass.split(" "),o=n.querySelector("."+i[0]);o&&n.removeChild(o);A2ta.Map.chargerGeoPoints(a)}(function(e,t){var a=document.createElement("li");a.className=A2ta.config.keywords.listItemClass;var n=document.createElement("span");n.className=A2ta.config.keywords.labelClass,n.appendChild(document.createTextNode(e));var r=document.createElement("button");return r.className=A2ta.config.keywords.buttonClass,r.id=A2ta.config.keywords.buttonID,r.dataset.value=t,r.addEventListener("click",l,!1),a.appendChild(n),a.appendChild(r),a}(n,r))}}function i(t,a){"focus"==t.type&&e[a].classList.add("is-Focused"),"blur"==t.type&&""==t.target.value&&e[a].classList.remove("is-Focused")}function o(e){var t="";t=e?`Aucun résultat pour « ${e} »`:"Aucun résultat";var a=document.createElement("div");a.className=A2ta.config.search.messageClass;var n=document.createElement("span");if(n.className=A2ta.config.search.messageLabelClass,n.appendChild(document.createTextNode(t)),a.appendChild(n),e){var r=document.createElement("button");r.className=A2ta.config.search.messageDeleteClass,r.addEventListener("click",s,!1),a.appendChild(r)}return a}function s(e){var t=this.offsetParent;t.offsetParent.removeChild(t)}function l(e){var n=this.dataset.value,r=this.offsetParent,i=a.indexOf(n);if(-1!==n){t.splice(i,1),a.splice(i,1),r.removeChild(r.childNodes[i]);var o=A2ta.config.search.messageClass.split(" "),s=r.parentNode.querySelector("."+o[0]);s&&r.parentNode.removeChild(s),A2ta.Map.chargerGeoPoints(a)}}return{init:function(){var t=A2ta.Map.getMapContainer();if(t){var a=t.querySelector("#"+A2ta.config.search.searchID);!function(t){e=t.querySelectorAll("."+A2ta.config.search.labelClass);var a=t.querySelectorAll("input[type=text]");e.forEach((function(e){e.classList.add("js-FormLabel")})),a.forEach((function(e,t){e.addEventListener("focus",(function(e){i(e,t)}),!1),e.addEventListener("blur",(function(e){i(e,t)}),!1)}))}(a),function(e){e.querySelector("#"+A2ta.config.search.advancedPanelID).querySelectorAll("."+A2ta.config.search.categoryClass).forEach((function(e){e.addEventListener("click",n,!1)}))}(a),A2ta.Map.Search.Panels.init(),A2ta.Map.Search.Scroll.init(),A2ta.Map.Search.Tabs.init()}},autocompleteFullText:function(e,t){return r({label:t.item.label,value:t.item.value}),this.value="",!1},getNoResultMessage:o}}(),A2ta.Map.Search.Panels=A2ta.Map.Search.Panels||{},A2ta.Map.Search.Panels=function(){var e=null;function t(t){var a=t||0;e.forEach((function(e,t){t==a?function(e){r(e,!0),i(e,!1);e.offsetHeight;var t=e.scrollHeight;e.addEventListener("transitionend",o,!1),e.style.height=t+"px"}(e):function(e){e.style.height=e.getBoundingClientRect().height+"px",r(e,!0);e.offsetHeight;e.addEventListener("transitionend",s,!1),e.style.height=""}(e)}))}function a(e){var a="true"==this.getAttribute("aria-expanded");n(this,!a),t(a?0:1)}function n(e,t){e.setAttribute("aria-expanded",t)}function r(e,t){e.setAttribute("aria-busy",t)}function i(e,t){e.setAttribute("aria-hidden",t)}function o(e){this.style.height="",r(this,!1),this.removeEventListener("transitionend",o,!1)}function s(e){r(this,!1),i(this,!0),this.removeEventListener("transitionend",s,!1)}return{init:function(){var r=A2ta.Map.getMapContainer();if(r){var i=r.querySelector("#"+A2ta.config.search.searchID),o=i.querySelector("#"+A2ta.config.search.triggerID);e=i.querySelectorAll("#"+A2ta.config.search.fulltextPanelID+", #"+A2ta.config.search.advancedPanelID),o.addEventListener("click",a,!1),n(o,!1),t(0)}}}}(),A2ta.Map.Search.Scroll=A2ta.Map.Search.Scroll||{},A2ta.Map.Search.Scroll=function(){var e=null,t=null,a=null,n=null,r=null,i=null,o=null,s=null;function l(){r=e.clientWidth,i=t.scrollWidth,i-r,n.style.transform="translate3d(0, 0, 0)",n.style.width=r/i*100+"%",n.clientWidth,n.style.zIndex=r>=i?-1:2,a.style.zIndex=r>=i?-1:1}function c(){n.style.transform="translate3d("+o+"px, 0, 0)"}function u(t){e.scrollLeft=i*(t.offsetX/r)}function d(t){t.preventDefault(),t.stopPropagation(),s=t.offsetX+e.getBoundingClientRect().left,e.addEventListener("mousemove",f,!1),e.addEventListener("mouseup",m,!1)}function f(t){t.preventDefault(),t.stopPropagation(),e.scrollLeft=i*((t.clientX-s)/r)}function m(t){t.preventDefault(),t.stopPropagation(),e.removeEventListener("mousemove",f),e.removeEventListener("mouseup",f)}return{init:function(){var s,f=A2ta.Map.getMapContainer();f&&(e=f.querySelector("."+A2ta.config.search.scrollContainerClass),t=e.firstElementChild,a=e.querySelector("."+A2ta.config.search.scrollbarClass),n=e.querySelector("."+A2ta.config.search.scrollbarFillClass),l(),e.addEventListener("scroll",(function(e){cancelAnimationFrame(s),o=r*(e.target.scrollLeft/i),s=requestAnimationFrame(c)})),a.addEventListener("mousedown",u,!1),n.addEventListener("mousedown",d,!1))},setScrollSize:l}}(),A2ta.Map.Search.Tabs=A2ta.Map.Search.Tabs||{},A2ta.Map.Search.Tabs=function(){function e(e){e.setAttribute("aria-selected","true")}function t(e){e.setAttribute("aria-hidden","false")}function a(e){if(!Array.isArray(e))return e.setAttribute("aria-hidden","true");e.forEach((function(e){return e.setAttribute("aria-hidden","true")}))}function n(e){if(!Array.isArray(e))return e.setAttribute("aria-selected","false");e.forEach((function(e){return e.setAttribute("aria-selected","false")}))}return{init:function(){var r=A2ta.Map.getMapContainer().querySelector("#"+A2ta.config.search.advancedPanelID),i=r.children[0],o=r.children[1],s=_toConsumableArray(i.children),l=_toConsumableArray(o.children);s.forEach((function(r,i){var o=l[i];n(r),a(o),r.addEventListener("click",(function(r){!function(r,i){n(_toConsumableArray(r.parentNode.children)),a(_toConsumableArray(i.parentNode.children)),e(r),t(i)}(r.currentTarget,o)}),!1),0==i&&(e(r),t(o))}))}}}(),Array.from||(Array.from=function(){var e=Object.prototype.toString,t=function(t){return"function"==typeof t||"[object Function]"===e.call(t)},a=Math.pow(2,53)-1,n=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),a)};return function(e){var a=this,r=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var i,o=arguments.length>1?arguments[1]:void 0;if(void 0!==o){if(!t(o))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(i=arguments[2])}for(var s,l=n(r.length),c=t(a)?Object(new a(l)):new Array(l),u=0;u<l;)s=r[u],c[u]=o?void 0===i?o(s,u):o.call(i,s,u):s,u+=1;return c.length=l,c}}()),window.addEventListener("load",(function(e){A2ta.init()}),!1);